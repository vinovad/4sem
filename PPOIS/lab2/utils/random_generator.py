"""
random_generator.py - генератор уникальных тестовых данных

Генерирует 100 уникальных записей о питомцах для демонстрации.
Использует предоставленные имена (50 для demo1.xml, 50 для demo2.xml),
чтобы гарантировать отсутствие дубликатов при загрузке обоих файлов.
"""

import sys
import os
# Добавляем корневую директорию проекта в путь Python
sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

import random
from datetime import date, timedelta
from model import Pet, PetDatabase, XMLHandler

# Первые 50 уникальных имен для demo1.xml
PET_NAMES_DEMO1 = [
    "Айс", "Аэро", "Арден", "Альф", "Алекс", "Арто", "Арчи", "Барни", "Барон", "Вилли",
    "Бруно", "Бинго", "Бумер", "Кэш", "Шеф", "Шериф", "Дизель", "Локи", "Дюк", "Феликс",
    "Фред", "Гизмо", "Джек", "Логан", "Пеппер", "Поттер", "Руфус", "Римус", "Реми", "Рекс",
    "Рокси", "Орео", "Нельсон", "Микки", "Ник", "Ден", "Честер", "Веселый Роджер", "Хэнк", "Бони",
    "Клайд", "Лен", "Скуби", "Скай", "Тедди", "Вуди", "Тайсон", "Тесла", "Кузя", "Нафаня"
]

# Вторые 50 уникальных имен для demo2.xml (полностью отличаются от первых 50)
PET_NAMES_DEMO2 = [
    "Алиса", "Ава", "Берта", "Бианка", "Карма", "Ленни", "Ариэль", "Мартина", "Марта", "Майя",
    "Ева", "Милка", "Маркиза", "Муля", "Мия", "Дора", "Прада", "Парди", "Ромашка", "Пенелопа",
    "Салли", "Салти", "Оливия", "Николь", "Зена", "Зара", "Трикси", "Стелла", "Флора", "Фиона",
    "Фаня", "Лейла", "Тутси", "Симона", "Сайона", "Сима", "Мара", "Мона", "Тесса", "Смоки",
    "Лиза", "Лада", "Лана", "Дана", "Элли", "Лили", "Софи", "Кики", "Лотта", "Мэгги"
]

# Списки для генерации данных (остаются общими для обоих файлов)
VET_NAMES = [
    "Иванов Петр Сергеевич", "Смирнова Анна Владимировна", "Кузнецов Дмитрий Алексеевич",
    "Попова Елена Ивановна", "Соколов Михаил Петрович", "Лебедева Ольга Николаевна",
    "Новиков Артем Викторович", "Козлова Татьяна Владимировна", "Морозов Сергей Андреевич",
    "Петрова Мария Дмитриевна", "Волков Андрей Сергеевич", "Семенова Наталья Алексеевна",
    "Алексеев Владимир Дмитриевич", "Егорова Светлана Михайловна", "Комаров Иван Иванович",
    "Орлова Екатерина Петровна", "Макаров Алексей Владимирович", "Голубева Наталья Сергеевна",
    "Фролов Виктор Анатольевич", "Сорокин Константин Николаевич", "Яковлев Геннадий Степанович",
    "Филиппов Валерий Петрович", "Медведев Георгий Владимирович", "Осипов Виктор Семенович",
    "Павлов Валентин Иванович", "Соловьев Вячеслав Григорьевич", "Васильев Виктор Владимирович",
    "Захаров Виктор Петрович", "Жуков Виктор Семенович", "Наумов Виктор Анатольевич"
]

DIAGNOSES = [
    "Воспаление уха, требуется курс антибиотиков",
    "Аллергическая реакция на новую пищу",
    "Простуда, рекомендовано тепло и покой",
    "Ранение лапы, требуется обработка и перевязка",
    "Гастрит, требуется диета и медикаменты",
    "Дерматит, требуется местное лечение",
    "Проблемы с зубами, требуется чистка",
    "Запор, требуется коррекция питания",
    "Кожный клещ, требуется обработка противопаразитарным средством",
    "Вирусная инфекция, требуется изоляция и лечение",
    "Перелом хвоста, требуется иммобилизация",
    "Глазная инфекция, требуется капли",
    "Отравление, требуется промывание желудка и сорбенты",
    "Панкреатит, требуется строгая диета",
    "Паразиты, требуется дегельминтизация",
    "Гипотиреоз, требуется пожизненный прием гормонов",
    "Артрит, требуется физиотерапия и обезболивающие",
    "Мочекаменная болезнь, требуется диета и медикаменты",
    "Эпилепсия, требуется регулярный прием противосудорожных",
    "Диабет, требуется инсулинотерапия и контроль питания",
    "Стоматит, требуется лечение антисептиками",
    "Анемия, требуется коррекция питания и препараты железа",
    "Облысение, требуется витаминотерапия",
    "Конъюнктивит, требуется глазные капли",
    "Пневмония, требуется антибиотикотерапия",
    "Гепатит, требуется комплексное лечение",
    "Гастроэнтерит, требуется диета и медикаменты",
    "Цистит, требуется антибиотики и обильное питье",
    "Пиометра, требуется срочная операция",
    "Гипертиреоз, требуется медикаментозная коррекция",
    "Травма от прыжка с высоты, требуется покой",
    "Повреждение связок, требуется физиотерапия",
    "Аллергия на пыльцу, требуется антигистаминные",
    "Заболевание суставов, требуется лечебная гимнастика",
    "Нарушение слуха, требуется обследование",
    "Проблемы со зрением, требуется консультация специалиста",
    "Нарушение координации, требуется неврологическое обследование",
    "Сердечная недостаточность, требуется постоянный контроль",
    "Обезвоживание, требуется восполнение жидкости",
    "Гипогликемия, требуется коррекция питания"
]

def generate_demo_data(pet_names, count=50):
    """
    Генерирует демо-данные с указанным количеством записей
    
    Args:
        pet_names: Список имен для использования
        count: Количество записей для генерации
    
    Returns:
        Список объектов Pet
    """
    database = PetDatabase()
    
    for i in range(count):
        # Имя питомца из предоставленного списка
        name = pet_names[i]
        
        # Дата рождения (случайная дата за последние 15 лет)
        today = date.today()
        start_date = today - timedelta(days=15*365)
        random_days = random.randint(0, (today - start_date).days)
        birth_date = start_date + timedelta(days=random_days)
        
        # Дата последнего приема (после даты рождения)
        start_date = birth_date
        # Ограничиваем интервал до 5 лет от даты рождения
        max_days = min(365*5, (today - start_date).days)
        if max_days <= 0:
            max_days = 1
        random_days = random.randint(0, max_days)
        last_visit = start_date + timedelta(days=random_days)
        
        # ФИО ветеринара
        vet_name = random.choice(VET_NAMES)
        
        # Диагноз
        diagnosis = random.choice(DIAGNOSES)
        
        # Создаем питомца и добавляем в базу
        pet = Pet(name, birth_date, last_visit, vet_name, diagnosis)
        database.add_pet(pet)
    
    return database.get_all_pets()

def save_demo_data(filename, pet_names, count=50):
    """
    Генерирует и сохраняет демо-данные в XML-файл
    
    Args:
        filename: Имя файла для сохранения
        pet_names: Список имен для использования
        count: Количество записей для генерации
    
    Returns:
        Путь к сохраненному файлу
    """
    pets = generate_demo_data(pet_names, count)
    XMLHandler.save_to_xml(pets, filename)
    return filename

if __name__ == "__main__":
    import argparse
    
    parser = argparse.ArgumentParser(description='Генератор уникальных демо-данных для ветеринарной клиники')
    parser.add_argument('--output', type=str, default='data/demo.xml', 
                        help='Путь для сохранения XML-файла')
    parser.add_argument('--count', type=int, default=50, 
                        help='Количество записей для генерации')
    parser.add_argument('--demo-set', type=int, choices=[1, 2], required=True,
                        help='Набор имен для использования (1 или 2)')
    
    args = parser.parse_args()
    
    # Создаем директорию data, если ее нет
    os.makedirs(os.path.dirname(args.output), exist_ok=True)
    
    # Выбираем соответствующий набор имен
    pet_names = PET_NAMES_DEMO1 if args.demo_set == 1 else PET_NAMES_DEMO2
    
    # Генерируем и сохраняем данные
    result_file = save_demo_data(args.output, pet_names, args.count)
    
    print(f"Сгенерировано {args.count} уникальных записей и сохранено в {result_file}")
